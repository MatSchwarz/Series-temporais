---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Cmd+Shift+Enter*. 
```{r}
library("seasonal") #Arima X13-Seats
library("mFilter") #Filtro HP
```

```{r}
ts_do_trab <- ts(UNRATENSA$UNRATENSA,start = c(2010,1), frequency = 12)
decomp_trab <- decompose(ts_do_trab)
UNRATENSA["UNRATENSA sem saz"] = ts_do_trab - decomp_trab$seasonal
```
```{r}
plot(UNRATENSA$DATE,UNRATENSA$UNRATENSA,"l", xlab = "data", ylab = "taxa desemprego EUA")
lines(UNRATENSA$DATE,UNRATENSA$`UNRATENSA sem saz`,"l", xlab = "data", ylab = "Taxa desemprego EUA", col = "blue")
```
```{r}
modelo_sazonaltrab = seas(ts_do_trab)
plot(modelo_sazonaltrab)

arima_x13trab = predict(modelo_sazonaltrab)
UNRATENSA["UNRATENSA arima x13"] <- arima_x13trab
```
Para essa base de dados de desemprego nos Estados Unidos parece haver sim uma sazonalidade anual.


Questão 2

```{r}
#Filtro HP
filtradotrab = hpfilter(log(arima_x13trab),type = "lambda")

plot(filtradotrab$trend - log(arima_x13trab), col='red')
```
```{r}
plot(log(arima_x13trab), col='red')
lines(filtradotrab$trend,col='blue')
```


A série temporal como visto no gráfico acima também parece apresentar ciclos e ela parece apresentar uma tendencia linear se comparado com o gráfico do arima x13.

Questão 3

```{r}
#Proposta de Hamilton
base = cbind(arima_x13trab,do.call(cbind, lapply(-24-0:3, function(x) lag(arima_x13trab, x))))
colnames(base) = c('l_air', paste('L',0:3,sep=''))

#Passando para log (modelo multiplicativo!)
base = base

model = lm(l_air~., data = base)

base = cbind(base, 'hamilton_cycle' =base[,1]- predict(model, base))

plot(base[,"hamilton_cycle"], col = 'blue')
abline(h=0)
```
O filtro HP nessa situação se assemelha bastante com o Hamilton, só que o Hamilton corta os primeiros dois anos da amostra.



Segunda base de dados

```{r}
ts_do_M2 <- ts(M2NS$M2NS,start = c(2019,7), frequency = 12)
decomp_M2 <- decompose(ts_do_M2)
M2NS["M2NS sem saz"] = ts_do_M2 - decomp_M2$seasonal
```
```{r}
plot(M2NS$DATE,M2NS$M2NS,"l", xlab = "data", ylab = "valor do M2")
lines(M2NS$DATE,M2NS$`M2NS sem saz`,"l", xlab = "data", ylab = "valor do M2", col = "blue")
```
```{r}
modelo_sazonalM2 = seas(ts_do_M2)
plot(modelo_sazonalM2)

arima_x13M2 = predict(modelo_sazonalM2)
M2NS["M2NS arima x13"] <- arima_x13M2
```
Observando os dois gráficos não parece existir uma tendência sazonal como no primeiro caso


Questão 2

```{r}
#Filtro HP
filtradoM2 = hpfilter(log(arima_x13M2),type = "lambda")

plot(filtradoM2$trend - log(arima_x13M2))
```
```{r}
plot(log(arima_x13M2), col='red')
lines(filtradoM2$trend,col='blue')
```
Porém ainda parece existir uma componente ciclica na série temporal


Questão 3

```{r}
#Proposta de Hamilton
base = cbind(arima_x13M2,do.call(cbind, lapply(-24-0:3, function(x) lag(arima_x13M2, x))))
colnames(base) = c('l_air', paste('L',0:3,sep=''))

#Passando para log (modelo multiplicativo!)
base = log(base)

model = lm(l_air~., data = base)

base = cbind(base, 'hamilton_cycle' =base[,1]- predict(model, base))

plot(base[,"hamilton_cycle"], col = 'blue')
abline(h=0)
```
comparando o ciclo HP e o ciclo de Hamilton, neste caso eles ficaram com suas tendências invertidas não se comparando, talvez isso esteja associado com o ciclo de hamilton descartar os primeiros 2 anos. Mas, mesmo assim os limites da variância em log ainda ficaram similares.


